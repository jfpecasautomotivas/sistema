<div class="row">
    <div class="col s12 center">
        <h3>Estoque/Baixas</h3>
    </div>
</div>

<div class="row">
    <div class="col s12">
        <h4>Pesquisar</h4>
    </div>
    <form class="col s12">
        <div class="row">
            <div class="input-field col s4">
                <select [(ngModel)]="filterType" name="filterType">
                  <option value="title" selected>Título</option>
                  <option value="ref">Referencia</option>
                </select>                
                <label>Selecione o filtro</label>
              </div>
            
            <div class="input-field col s8">
                <input type="text" placeholder="Título ou Referência do produto" [(ngModel)]="filter" name="filter" (keyup)="search()">
                <label for="filter">Título ou Referência do produto</label>
            </div>
        </div>
    </form>
</div>

<ul class="pagination">
    <li [ngClass]="{'disabled' : (productsInfos?.current_page === 1)}">
        <a routerLink="/inventory-{{screenType}}" [queryParams]="{'page':(productsInfos?.current_page - 1)}">
            <i class="material-icons">chevron_left</i>
        </a>
    </li>
    <li *ngFor="let page of pagination; let i = index" class="waves-effect" [ngClass]="{'active' : ((i+1) === productsInfos?.current_page)}">
        <a routerLink="/inventory-{{screenType}}" [queryParams]="{'page':(i + 1)}">{{ i + 1 }} </a>
    </li>
    <li [ngClass]="{'disabled' : (productsInfos?.current_page === productsInfos?.last_page)}">
        <a routerLink="/inventory-{{screenType}}" [queryParams]="{'page':(productsInfos?.current_page + 1)}">
            <i class="material-icons">chevron_right</i>
        </a>
    </li>
</ul>
<table>
    <thead>
        <tr>
            <th>Ref.</th>
            <th>Nome</th>
            <th>Custo</th>
            <th>Valor Venda</th>
            <th>Aplicação</th>
            <th>Quantidade</th>
            <th *ngIf="screenType === 'sell'">Baixa</th>
            <th *ngIf="screenType === 'edit'">Editar</th>
            <th *ngIf="screenType === 'add'">Adicionar</th>
        </tr>
    </thead>

    <tbody>
        <tr *ngFor="let product of productsInfos?.data">
            <td>{{ product.ref }}</td>
            <td>{{ product.title }}</td>
            <td>{{ product.value_buy }}</td>
            <td>{{ product.value_sell }}</td>
            <td>{{ product.application }}</td>
            <td>{{ product.amount }}</td>
            <td *ngIf="screenType === 'sell'">
                <button class="btn green modal-trigger" data-target="sells" (click)="selectProduct(product)">
                    <i class="material-icons">
                        shopping_cart
                    </i>
                </button>
            </td>
            <td *ngIf="screenType === 'add'">
                <button class="btn green modal-trigger" data-target="add-amount" (click)="selectProduct(product)">
                    <i class="material-icons">
                        add
                    </i>
                </button>
            </td>
            <td *ngIf="screenType === 'edit'">
                <a class="btn blue" routerLink="//products/{{product.id}}">
                    <i class="material-icons">
                        create
                    </i>
                </a>
            </td>
        </tr>
    </tbody>
</table>
<ul class="pagination">
    <li [ngClass]="{'disabled' : (productsInfos?.current_page === 1)}">
        <a routerLink="/inventory-{{screenType}}" [queryParams]="{'page':(productsInfos?.current_page - 1)}">
            <i class="material-icons">chevron_left</i>
        </a>
    </li>
    <li *ngFor="let page of pagination; let i = index" class="waves-effect" [ngClass]="{'active' : ((i+1) === productsInfos?.current_page)}">
        <a routerLink="/inventory-{{screenType}}" [queryParams]="{'page':(i + 1)}">{{ i + 1 }} </a>
    </li>
    <li [ngClass]="{'disabled' : (productsInfos?.current_page === productsInfos?.last_page)}">
        <a routerLink="/inventory-{{screenType}}" [queryParams]="{'page':(productsInfos?.current_page + 1)}">
            <i class="material-icons">chevron_right</i>
        </a>
    </li>
</ul>

<!-- Modal Structure -->
<div id="sells" class="modal sells">
    <div class="modal-content">
        <h4>Dar baixa em {{ selectedProduct?.title }}</h4>
        <form class="col s12" [formGroup]="saleForm">
            <div class="row">
                <div class="input-field col s12">
                    <input type="number" placeholder="Quantidade" formControlName="amount" name="amount">
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
      <button class="waves-effect waves-green btn green" (click)="sell()">Salvar</button>
      <button class="modal-close waves-effect waves-red btn red">Fechar</button>
    </div>
</div>

<!-- Modal Structure -->
<div id="add-amount" class="modal">
    <div class="modal-content">
        <h4>Adicionar ao estoque {{ selectedProduct?.title }}</h4>
        <span>Atualmente possui <strong class="success">{{ selectedProduct?.amount }} itens</strong> </span>
        <form class="col s12" >
            <div class="row">
                <div class="input-field col s12">
                    <input type="number" placeholder="Quantidade" [(ngModel)]="amount" name="amount">
                    <label for="amount">Quantidade que deseja adicionar</label>
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
      <button class="waves-effect waves-green btn green" (click)="addAmount()">Adicionar</button>
      <button class="modal-close waves-effect waves-red btn red">Fechar</button>
    </div>
</div>